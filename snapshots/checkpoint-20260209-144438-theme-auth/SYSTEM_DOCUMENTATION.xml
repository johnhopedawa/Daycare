<?xml version="1.0" encoding="UTF-8"?>
<daycare-management-system>
  <metadata>
    <project-name>Daycare Management System</project-name>
    <description>Full-stack web application for managing daycare operations including enrollment, attendance, billing, scheduling, and payroll</description>
    <tech-stack>
      <backend>Node.js, Express.js, PostgreSQL</backend>
      <frontend>React, Tailwind CSS, Framer Motion</frontend>
      <authentication>JWT (JSON Web Tokens)</authentication>
      <pdf-generation>PDFKit</pdf-generation>
      <excel-export>ExcelJS</excel-export>
    </tech-stack>
    <last-updated>2026-02-09</last-updated>
    <documentation-status>Updated with split Staff/Admin vs Parent portal theme selection, Little Sparrows Public visual parity across parent dashboard/login, parent logout redirect to /parents, and parent login stay-logged-in credential persistence</documentation-status>
    <debug-runbook>BUGS_AND_FIXES.xml</debug-runbook>
  </metadata>

  <!-- ======================= DATABASE SCHEMA ======================= -->
  <database-schema>
    <migrations-directory>backend/migrations/</migrations-directory>
    <total-migrations>38</total-migrations>
    <migration-pattern>Sequential numbered migrations (000_*.sql through 037_*.sql)</migration-pattern>

    <!-- Core User Management -->
    <table name="users">
      <description>Staff and parent accounts for system access</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="email" type="VARCHAR(255)" unique="true" required="true"/>
        <column name="password_hash" type="VARCHAR(255)" required="true"/>
        <column name="first_name" type="VARCHAR(100)" required="true"/>
        <column name="last_name" type="VARCHAR(100)" required="true"/>
        <column name="role" type="VARCHAR(20)" required="true">
          <constraints>CHECK IN ('EDUCATOR', 'ADMIN', 'PARENT')</constraints>
          <note>Parents are stored in users with role PARENT and linked to parents via parents.user_id</note>
        </column>
        <column name="hourly_rate" type="DECIMAL(10,2)" description="Educator hourly pay rate"/>
        <column name="is_active" type="BOOLEAN" default="true"/>
        <column name="must_reset_password" type="BOOLEAN" default="false"/>
        <column name="annual_sick_days" type="INTEGER" default="0"/>
        <column name="annual_vacation_days" type="INTEGER" default="0"/>
        <column name="sick_days_remaining" type="DECIMAL(5,2)" default="0"/>
        <column name="vacation_days_remaining" type="DECIMAL(5,2)" default="0"/>
        <column name="carryover_enabled" type="BOOLEAN" default="false"/>
        <column name="date_employed" type="DATE"/>
        <column name="ytd_gross" type="DECIMAL(10,2)" default="0"/>
        <column name="ytd_cpp" type="DECIMAL(10,2)" default="0"/>
        <column name="ytd_ei" type="DECIMAL(10,2)" default="0"/>
        <column name="ytd_tax" type="DECIMAL(10,2)" default="0"/>
        <column name="ytd_hours" type="DECIMAL(10,2)" default="0"/>
        <column name="sin" type="VARCHAR(11)" description="Social Insurance Number"/>
        <column name="created_by" type="INTEGER" references="users(id)"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <table name="parents">
      <description>Parent/guardian records linked to user accounts for portal access</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="first_name" type="VARCHAR(100)" required="true"/>
        <column name="last_name" type="VARCHAR(100)" required="true"/>
        <column name="family_name" type="VARCHAR(150)" description="Optional custom family display name"/>
        <column name="email" type="VARCHAR(255)"/>
        <column name="phone" type="VARCHAR(20)"/>
        <column name="address_line1" type="VARCHAR(255)"/>
        <column name="address_line2" type="VARCHAR(255)"/>
        <column name="city" type="VARCHAR(100)"/>
        <column name="province" type="VARCHAR(100)"/>
        <column name="postal_code" type="VARCHAR(20)"/>
        <column name="child_names" type="TEXT" description="Legacy field - now computed from parent_children relationship"/>
        <column name="notes" type="TEXT"/>
        <column name="is_active" type="BOOLEAN" default="true"/>
        <column name="password_hash" type="VARCHAR(255)" description="Legacy field; parent auth uses users table"/>
        <column name="user_id" type="INTEGER" references="users(id)" description="Linked user account for unified auth"/>
        <column name="credit_balance" type="DECIMAL(10,2)" default="0" description="Parent credit balance for overpayments"/>
        <column name="role" type="VARCHAR(20)" default="PARENT">
          <constraints>CHECK IN ('PARENT')</constraints>
        </column>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <table name="children">
      <description>Enrolled children records</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="first_name" type="VARCHAR(100)" required="true"/>
        <column name="last_name" type="VARCHAR(100)" required="true"/>
        <column name="date_of_birth" type="DATE" required="true"/>
        <column name="enrollment_start_date" type="DATE" required="true"/>
        <column name="enrollment_end_date" type="DATE"/>
        <column name="status" type="VARCHAR(20)" required="true">
          <constraints>CHECK IN ('ACTIVE', 'ENROLLED', 'INACTIVE', 'WAITLIST')</constraints>
        </column>
        <column name="monthly_rate" type="DECIMAL(10,2)"/>
        <column name="billing_cycle" type="VARCHAR(20)" default="MONTHLY">
          <constraints>CHECK IN ('WEEKLY', 'BI_WEEKLY', 'MONTHLY')</constraints>
        </column>
        <column name="allergies" type="TEXT"/>
        <column name="medical_notes" type="TEXT"/>
        <column name="waitlist_priority" type="INTEGER" description="Auto-assigned for WAITLIST status (Migration 005)"/>
        <column name="notes" type="TEXT"/>
        <column name="created_by" type="INTEGER" references="users(id)"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <table name="parent_children">
      <description>Many-to-many relationship between parents and children</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="parent_id" type="INTEGER" references="parents(id)" on-delete="CASCADE"/>
        <column name="child_id" type="INTEGER" references="children(id)" on-delete="CASCADE"/>
        <column name="relationship" type="VARCHAR(50)" default="Parent" description="Mother, Father, Guardian, etc."/>
        <column name="is_primary_contact" type="BOOLEAN" default="false"/>
        <column name="can_pickup" type="BOOLEAN" default="true"/>
        <column name="has_billing_responsibility" type="BOOLEAN" default="false"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
      <constraints>
        <unique>parent_id, child_id</unique>
      </constraints>
    </table>

    <table name="emergency_contacts">
      <description>Emergency contacts for children (Migration 010)</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="child_id" type="INTEGER" references="children(id)" on-delete="CASCADE"/>
        <column name="name" type="VARCHAR(100)" required="true"/>
        <column name="phone" type="VARCHAR(20)"/>
        <column name="relationship" type="VARCHAR(50)"/>
        <column name="is_primary" type="BOOLEAN" default="false"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <!-- Time Tracking & Payroll -->
    <table name="time_entries">
      <description>Educator hours worked</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="user_id" type="INTEGER" references="users(id)" on-delete="CASCADE"/>
        <column name="entry_date" type="DATE" required="true"/>
        <column name="start_time" type="TIME"/>
        <column name="end_time" type="TIME"/>
        <column name="total_hours" type="DECIMAL(5,2)" required="true"/>
        <column name="notes" type="TEXT"/>
        <column name="status" type="VARCHAR(20)" required="true" default="PENDING">
          <constraints>CHECK IN ('PENDING', 'APPROVED', 'REJECTED')</constraints>
        </column>
        <column name="rejection_reason" type="TEXT"/>
        <column name="reviewed_by" type="INTEGER" references="users(id)"/>
        <column name="reviewed_at" type="TIMESTAMP"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <table name="pay_periods">
      <description>Payroll periods for educator compensation</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="name" type="VARCHAR(100)" required="true"/>
        <column name="start_date" type="DATE" required="true"/>
        <column name="end_date" type="DATE" required="true"/>
        <column name="status" type="VARCHAR(20)" required="true" default="OPEN">
          <constraints>CHECK IN ('OPEN', 'CLOSED')</constraints>
        </column>
        <column name="closed_at" type="TIMESTAMP"/>
        <column name="closed_by" type="INTEGER" references="users(id)"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <table name="payouts">
      <description>Generated when pay period closes</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="pay_period_id" type="INTEGER" references="pay_periods(id)" on-delete="CASCADE"/>
        <column name="user_id" type="INTEGER" references="users(id)" on-delete="CASCADE"/>
        <column name="total_hours" type="DECIMAL(10,2)" required="true"/>
        <column name="hourly_rate" type="DECIMAL(10,2)" required="true"/>
        <column name="gross_amount" type="DECIMAL(10,2)" required="true"/>
        <column name="deductions" type="DECIMAL(10,2)" default="0"/>
        <column name="net_amount" type="DECIMAL(10,2)" required="true"/>
        <column name="status" type="VARCHAR(20)" default="PENDING">
          <constraints>CHECK IN ('PENDING', 'PAID')</constraints>
        </column>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <table name="paystubs">
      <description>PDF generation records for paystubs</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="payout_id" type="INTEGER" references="payouts(id)" on-delete="CASCADE"/>
        <column name="user_id" type="INTEGER" references="users(id)" on-delete="CASCADE"/>
        <column name="pay_period_id" type="INTEGER" references="pay_periods(id)" on-delete="CASCADE"/>
        <column name="stub_number" type="VARCHAR(50)" unique="true" required="true"/>
        <column name="generated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <!-- Scheduling -->
    <table name="schedules">
      <description>Staff shift schedules</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="user_id" type="INTEGER" references="users(id)" on-delete="CASCADE"/>
        <column name="created_by" type="INTEGER" references="users(id)"/>
        <column name="shift_date" type="DATE" required="true"/>
        <column name="start_time" type="TIME" required="true"/>
        <column name="end_time" type="TIME" required="true"/>
        <column name="hours" type="DECIMAL(5,2)" required="true"/>
        <column name="notes" type="TEXT"/>
        <column name="status" type="VARCHAR(20)" default="ACCEPTED">
          <constraints>CHECK IN ('PENDING', 'ACCEPTED', 'DECLINED')</constraints>
        </column>
        <column name="decline_reason" type="TEXT"/>
        <column name="decline_type" type="VARCHAR(20)">
          <constraints>CHECK IN ('SICK_DAY', 'VACATION_DAY', 'UNPAID')</constraints>
        </column>
        <column name="responded_at" type="TIMESTAMP"/>
        <column name="recurrence_id" type="INTEGER" references="schedule_recurrence(id)"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
      <business-logic>
        <rule>Declining schedule deducts from sick_days_remaining or vacation_days_remaining</rule>
        <rule>Deduction calculation: hours / 8 = days deducted</rule>
      </business-logic>
    </table>

    <table name="schedule_recurrence">
      <description>Recurring schedule patterns</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="user_id" type="INTEGER" references="users(id)" on-delete="CASCADE"/>
        <column name="created_by" type="INTEGER" references="users(id)"/>
        <column name="day_of_week" type="INTEGER" description="0-6 (Sunday-Saturday)"/>
        <column name="start_time" type="TIME" required="true"/>
        <column name="end_time" type="TIME" required="true"/>
        <column name="hours" type="DECIMAL(5,2)" required="true"/>
        <column name="start_date" type="DATE" required="true"/>
        <column name="end_date" type="DATE"/>
        <column name="notes" type="TEXT"/>
        <column name="is_active" type="BOOLEAN" default="true"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
      <status>NO FRONTEND UI - Backend ready</status>
    </table>

    <!-- Billing & Invoicing -->
    <table name="parent_invoices">
      <description>Daycare invoices to parents (Migration 003, 009)</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="parent_id" type="INTEGER" references="parents(id)" on-delete="CASCADE"/>
        <column name="child_id" type="INTEGER" references="children(id)" on-delete="SET NULL"/>
        <column name="invoice_number" type="VARCHAR(50)" unique="true" required="true"/>
        <column name="invoice_date" type="DATE" required="true"/>
        <column name="due_date" type="DATE" required="true"/>
        <column name="line_items" type="JSONB" required="true" description="Array of {description, quantity, rate, amount}"/>
        <column name="subtotal" type="DECIMAL(10,2)" required="true"/>
        <column name="tax_rate" type="DECIMAL(5,4)" default="0"/>
        <column name="tax_amount" type="DECIMAL(10,2)" default="0"/>
        <column name="total_amount" type="DECIMAL(10,2)" required="true"/>
        <column name="amount_paid" type="DECIMAL(10,2)" default="0"/>
        <column name="balance_due" type="DECIMAL(10,2)" required="true"/>
        <column name="status" type="VARCHAR(20)" required="true" default="DRAFT">
          <constraints>CHECK IN ('DRAFT', 'SENT', 'PARTIAL', 'PAID', 'OVERDUE')</constraints>
        </column>
        <column name="notes" type="TEXT"/>
        <column name="payment_terms" type="VARCHAR(100)"/>
        <column name="created_by" type="INTEGER" references="users(id)"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <table name="parent_payments">
      <description>Payment records from parents (Migration 009)</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="parent_id" type="INTEGER" references="parents(id)" on-delete="CASCADE"/>
        <column name="invoice_id" type="INTEGER" references="parent_invoices(id)" on-delete="SET NULL"/>
        <column name="amount" type="DECIMAL(10,2)" required="true"/>
        <column name="payment_date" type="DATE" required="true"/>
        <column name="status" type="VARCHAR(20)" default="PENDING">
          <constraints>CHECK IN ('PENDING', 'PAID')</constraints>
        </column>
        <column name="payment_method" type="VARCHAR(50)"/>
        <column name="notes" type="TEXT"/>
        <column name="receipt_number" type="VARCHAR(50)" unique="true"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <table name="parent_credits">
      <description>Credits applied to parent accounts (Migration 012)</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="parent_id" type="INTEGER" references="parents(id)" on-delete="CASCADE"/>
        <column name="payment_id" type="INTEGER" references="parent_payments(id)" on-delete="SET NULL"/>
        <column name="invoice_id" type="INTEGER" references="parent_invoices(id)" on-delete="SET NULL"/>
        <column name="amount" type="DECIMAL(10,2)" required="true"/>
        <column name="credit_type" type="VARCHAR(20)" required="true">
          <constraints>CHECK IN ('EARNED', 'APPLIED', 'ADJUSTMENT')</constraints>
        </column>
        <column name="memo" type="TEXT"/>
        <column name="created_by" type="INTEGER" references="users(id)"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <table name="billing_templates">
      <description>Recurring billing automation templates (Migration 007)</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="parent_id" type="INTEGER" references="parents(id)" on-delete="CASCADE"/>
        <column name="child_id" type="INTEGER" references="children(id)" on-delete="SET NULL"/>
        <column name="template_name" type="VARCHAR(100)" required="true"/>
        <column name="frequency" type="VARCHAR(20)" required="true">
          <constraints>CHECK IN ('WEEKLY', 'BI_WEEKLY', 'MONTHLY', 'QUARTERLY', 'ANNUAL')</constraints>
        </column>
        <column name="line_items" type="JSONB" required="true"/>
        <column name="subtotal" type="DECIMAL(10,2)" required="true"/>
        <column name="tax_rate" type="DECIMAL(5,4)" default="0.13"/>
        <column name="is_active" type="BOOLEAN" default="true"/>
        <column name="next_invoice_date" type="DATE"/>
        <column name="last_generated_date" type="DATE"/>
        <column name="created_by" type="INTEGER" references="users(id)"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
      <status>BACKEND COMPLETE - NO FRONTEND UI</status>
    </table>

    <!-- Attendance (Migration 007) -->
    <table name="attendance">
      <description>Daily child attendance tracking</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="child_id" type="INTEGER" references="children(id)" on-delete="CASCADE"/>
        <column name="attendance_date" type="DATE" required="true"/>
        <column name="check_in_time" type="TIME"/>
        <column name="check_out_time" type="TIME"/>
        <column name="checked_in_by" type="INTEGER" references="users(id)"/>
        <column name="checked_out_by" type="INTEGER" references="users(id)"/>
        <column name="parent_dropped_off" type="VARCHAR(100)"/>
        <column name="parent_picked_up" type="VARCHAR(100)"/>
        <column name="notes" type="TEXT"/>
        <column name="status" type="VARCHAR(20)" required="true" default="ABSENT">
          <constraints>CHECK IN ('PRESENT', 'ABSENT', 'LATE', 'SICK', 'VACATION')</constraints>
        </column>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
      <constraints>
        <unique>child_id, attendance_date</unique>
      </constraints>
    </table>

    <!-- Communication -->
    <table name="messages">
      <description>Staff-parent messaging system</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="from_user_id" type="INTEGER" references="users(id)" on-delete="SET NULL"/>
        <column name="from_parent_id" type="INTEGER" references="parents(id)" on-delete="SET NULL"/>
        <column name="to_user_id" type="INTEGER" references="users(id)" on-delete="SET NULL"/>
        <column name="to_parent_id" type="INTEGER" references="parents(id)" on-delete="SET NULL"/>
        <column name="subject" type="VARCHAR(255)"/>
        <column name="message" type="TEXT" required="true"/>
        <column name="is_read" type="BOOLEAN" default="false" description="Staff read status"/>
        <column name="parent_read" type="BOOLEAN" default="false" description="Parent read status"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
      <constraints>
        <check>from must be either user OR parent (not both)</check>
        <check>to must be either user OR parent (not both)</check>
      </constraints>
    </table>

    <table name="events">
      <description>Calendar events for parents, staff, or children (Migration 020)</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="created_by" type="INTEGER" references="users(id)" required="true"/>
        <column name="title" type="VARCHAR(255)" required="true"/>
        <column name="event_date" type="DATE" required="true"/>
        <column name="start_time" type="TIME"/>
        <column name="end_time" type="TIME"/>
        <column name="location" type="VARCHAR(255)"/>
        <column name="audience" type="VARCHAR(50)" default="ALL">
          <constraints>CHECK IN ('ALL', 'PARENTS', 'STAFF', 'CHILDREN')</constraints>
        </column>
        <column name="description" type="TEXT"/>
        <column name="requires_rsvp" type="BOOLEAN" default="false"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <!-- Documents -->
    <table name="documents">
      <description>File management and storage</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="original_filename" type="VARCHAR(255)" required="true"/>
        <column name="stored_filename" type="VARCHAR(255)" unique="true" required="true"/>
        <column name="file_path" type="VARCHAR(500)" required="true"/>
        <column name="file_size" type="INTEGER" required="true"/>
        <column name="mime_type" type="VARCHAR(100)" required="true"/>
        <column name="category_id" type="INTEGER" references="document_categories(id)" on-delete="SET NULL"/>
        <column name="tags" type="TEXT[]" description="Array of custom tags"/>
        <column name="description" type="TEXT"/>
        <column name="linked_child_id" type="INTEGER" description="Optional child association"/>
        <column name="linked_parent_id" type="INTEGER" description="Optional parent association"/>
        <column name="can_view_roles" type="JSONB" default='["ADMIN"]' description="Role-based access control"/>
        <column name="uploaded_by" type="INTEGER" references="users(id)"/>
        <column name="created_by" type="INTEGER" references="users(id)"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
      <file-storage>
        <location>backend/uploads/</location>
        <max-size>20MB</max-size>
        <allowed-types>PDF, JPG, PNG, DOCX, DOC</allowed-types>
      </file-storage>
    </table>

    <table name="document_categories">
      <description>DEPRECATED - Categories now hardcoded in code</description>
      <status>DEPRECATED</status>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="name" type="VARCHAR(100)" required="true"/>
        <column name="created_by" type="INTEGER" references="users(id)"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
      <hardcoded-categories>MEDICAL, ENROLLMENT, EMERGENCY, PHOTO_CONSENT, INSURANCE, OTHER</hardcoded-categories>
    </table>

    <!-- Authentication -->
    <table name="parent_sessions">
      <description>Parent portal login sessions (Migration 006)</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="parent_id" type="INTEGER" references="parents(id)" on-delete="CASCADE"/>
        <column name="token" type="VARCHAR(255)" unique="true" required="true"/>
        <column name="expires_at" type="TIMESTAMP" required="true"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <table name="parent_password_resets">
      <description>Parent password reset tokens</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="parent_id" type="INTEGER" references="parents(id)" on-delete="CASCADE"/>
        <column name="reset_token" type="VARCHAR(255)" unique="true" required="true"/>
        <column name="expires_at" type="TIMESTAMP" required="true"/>
        <column name="used" type="BOOLEAN" default="false"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <!-- System Settings -->
    <table name="themes">
      <description>UI theme catalog with palette + font metadata (Migration 015, seeded Migration 016 + 036)</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="name" type="VARCHAR(100)" required="true"/>
        <column name="slug" type="VARCHAR(100)" unique="true" required="true"/>
        <column name="description" type="TEXT"/>
        <column name="palette" type="JSONB" required="true">
          <schema>
            <field name="primary" type="string" description="Main brand color"/>
            <field name="primary_dark" type="string" description="Darker variant for hover/active states"/>
            <field name="accent" type="string" description="Secondary highlight color"/>
            <field name="background" type="string" description="Page background color"/>
            <field name="surface" type="string" description="Card/panel surface color"/>
            <field name="text" type="string" description="Primary text color"/>
            <field name="muted" type="string" description="Secondary/muted text color"/>
            <field name="border" type="string" description="Border color for UI elements"/>
            <field name="on_primary" type="string" description="Text color on primary backgrounds"/>
            <field name="on_accent" type="string" description="Text color on accent backgrounds"/>
            <field name="card_colors" type="array" description="Array of 4 background colors for dashboard cards"/>
            <field name="card_text_colors" type="array" description="Array of 4 contrasting text colors for dashboard cards"/>
            <field name="parent_background_image" type="string" description="Optional CSS background image value for parent portal shell"/>
            <field name="parent_overlay" type="string" description="Optional CSS color overlay for parent portal readability"/>
            <field name="parent_text" type="string" description="Optional primary text color for parent portal"/>
            <field name="parent_text_muted" type="string" description="Optional muted text color for parent portal"/>
            <field name="parent_card_base" type="string" description="Optional base color for translucent parent portal cards"/>
            <field name="parent_shell_bg" type="string" description="Optional parent portal shell background color"/>
            <field name="parent_shell_gradient" type="string" description="Optional decorative shell gradient"/>
            <field name="parent_header_bg" type="string" description="Optional parent header background color"/>
            <field name="parent_header_border" type="string" description="Optional parent header/nav border color"/>
            <field name="parent_nav_text" type="string" description="Optional default parent nav text color"/>
            <field name="parent_nav_active_text" type="string" description="Optional active parent nav text color"/>
            <field name="parent_nav_indicator" type="string" description="Optional active parent nav underline color"/>
            <field name="parent_card_shadow" type="string" description="Optional parent card shadow value"/>
            <field name="parent_input_bg" type="string" description="Optional parent input background color"/>
            <field name="parent_button_bg" type="string" description="Optional parent primary button background color"/>
          </schema>
        </column>
        <column name="fonts" type="JSONB" required="true">
          <schema>
            <field name="heading" type="string" description="Font family for headings"/>
            <field name="body" type="string" description="Font family for body text"/>
            <field name="import_url" type="string" description="Google Fonts import URL"/>
          </schema>
        </column>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
      <seeded-themes>
        <theme id="1" name="Default" slug="default" mood="Current system theme">
          <primary>#FF9B85</primary>
          <card_colors>#E5D4ED, #B8E6D5, #FFF4CC, #FFDCC8</card_colors>
          <card_text_colors>#44403C, #44403C, #44403C, #44403C</card_text_colors>
        </theme>
        <theme id="2" name="Ocean Breeze" slug="ocean-breeze" mood="Calm, trustworthy, fresh">
          <primary>#87CEEB</primary>
          <card_colors>#9FE2BF, #6CB4EE, #7FCDCD, #F5DEB3</card_colors>
          <card_text_colors>#1E3A5F, #1E3A5F, #1E3A5F, #44403C</card_text_colors>
        </theme>
        <theme id="3" name="Forest Garden" slug="forest-garden" mood="Organic, nurturing">
          <primary>#B2C9AB</primary>
          <card_colors>#A8B89F, #E07A5F, #F4E1C1, #D4A5A5</card_colors>
          <card_text_colors>#2D3B2D, #FFFFFF, #44403C, #44403C</card_text_colors>
        </theme>
        <theme id="4" name="Sunset Warmth" slug="sunset-warmth" mood="Welcoming, energetic">
          <primary>#FF9B85</primary>
          <card_colors>#FFB347, #FBCEB1, #E8927C, #F0C987</card_colors>
          <card_text_colors>#44403C, #44403C, #FFFFFF, #44403C</card_text_colors>
        </theme>
        <theme id="5" name="Berry Bright" slug="berry-bright" mood="Creative, confident">
          <primary>#9B6B9E</primary>
          <card_colors>#E85D75, #C5A3D9, #F4C2C2, #CCCCFF</card_colors>
          <card_text_colors>#FFFFFF, #2D1F3D, #44403C, #2D1F3D</card_text_colors>
        </theme>
        <theme id="6" name="Little Sparrows Public" slug="little-sparrows-public" mood="Public-site inspired">
          <primary>#5199A8</primary>
          <card_colors>#D7EEF2, #C5E4E9, #E7F4F6, #F2F8F9</card_colors>
          <card_text_colors>#2F4A4F, #2F4A4F, #2F4A4F, #2F4A4F</card_text_colors>
        </theme>
      </seeded-themes>
    </table>

    <table name="daycare_settings">
      <description>Singleton settings row (id=1) for system configuration</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="tax_rate" type="DECIMAL(5,4)" default="0.05"/>
        <column name="tax_enabled" type="BOOLEAN" default="true"/>
        <column name="theme_id" type="INTEGER" references="themes(id)"/>
        <column name="parent_theme_id" type="INTEGER" references="themes(id)" description="Parent-portal override theme; falls back to theme_id when unset"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <!-- Notifications (Migration 007) -->
    <table name="notifications">
      <description>Notification queue for email/SMS/in-app notifications</description>
      <status>EMAIL queue used; SMS pending; in-app notifications use app_notifications (Migration 022)</status>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="notification_type" type="VARCHAR(50)">
          <constraints>CHECK IN ('EMAIL', 'SMS', 'IN_APP')</constraints>
        </column>
        <column name="recipient_type" type="VARCHAR(20)">
          <constraints>CHECK IN ('PARENT', 'USER')</constraints>
        </column>
        <column name="recipient_id" type="INTEGER" required="true"/>
        <column name="recipient_email" type="VARCHAR(255)"/>
        <column name="recipient_phone" type="VARCHAR(20)"/>
        <column name="subject" type="VARCHAR(255)"/>
        <column name="message" type="TEXT" required="true"/>
        <column name="status" type="VARCHAR(20)" default="PENDING">
          <constraints>CHECK IN ('PENDING', 'SENT', 'FAILED', 'CANCELLED')</constraints>
        </column>
        <column name="sent_at" type="TIMESTAMP"/>
        <column name="error_message" type="TEXT"/>
        <column name="retry_count" type="INTEGER" default="0"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <!-- In-app Notifications (Migration 022) -->
    <table name="app_notifications">
      <description>In-app notification feed for admin users</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="recipient_id" type="INTEGER" references="users(id)" required="true"/>
        <column name="notification_type" type="VARCHAR(50)" required="true"/>
        <column name="title" type="VARCHAR(255)" required="true"/>
        <column name="message" type="TEXT"/>
        <column name="action_url" type="VARCHAR(255)"/>
        <column name="metadata" type="JSONB"/>
        <column name="is_read" type="BOOLEAN" default="false"/>
        <column name="read_at" type="TIMESTAMP"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
      <status>ACTIVE - notifications from time off requests, schedule declines, and parent messages</status>
    </table>

    <!-- Time Off Requests (Migration 023) -->
    <table name="time_off_requests">
      <description>Educator time-off requests with admin approval workflow</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="user_id" type="INTEGER" references="users(id)" required="true"/>
        <column name="start_date" type="DATE" required="true"/>
        <column name="end_date" type="DATE" required="true"/>
        <column name="request_type" type="VARCHAR(20)" required="true">
          <constraints>CHECK IN ('SICK', 'VACATION', 'UNPAID')</constraints>
        </column>
        <column name="hours" type="NUMERIC(5,2)" description="Optional requested hours for single-day requests"/>
        <column name="reason" type="TEXT"/>
        <column name="status" type="VARCHAR(20)" default="PENDING"/>
        <column name="reviewed_by" type="INTEGER" references="users(id)"/>
        <column name="reviewed_at" type="TIMESTAMP"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <!-- Business Expense Tracking (Migration 011) -->
    <table name="simplefin_connections">
      <description>SimpleFIN Bridge connections for business expense tracking</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="user_id" type="INTEGER" references="users(id)" on-delete="CASCADE" description="ADMIN only"/>
        <column name="access_url" type="TEXT" required="true" description="Encrypted SimpleFIN Access URL"/>
        <column name="account_name" type="VARCHAR(255)" required="true" description="User-friendly label"/>
        <column name="simplefin_account_id" type="VARCHAR(255)"/>
        <column name="firefly_account_id" type="VARCHAR(255)"/>
        <column name="account_type" type="VARCHAR(20)" default="credit"/>
        <column name="opening_balance" type="NUMERIC(12,2)"/>
        <column name="opening_balance_date" type="DATE"/>
        <column name="available_balance" type="NUMERIC(12,2)"/>
        <column name="available_balance_date" type="DATE"/>
        <column name="credit_limit" type="NUMERIC(12,2)" description="Optional manual credit limit for pending estimates"/>
        <column name="last_sync_at" type="TIMESTAMP"/>
        <column name="is_active" type="BOOLEAN" default="true"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
    </table>

    <table name="transaction_sync_log">
      <description>Deduplication tracking for SimpleFIN transactions</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="connection_id" type="INTEGER" references="simplefin_connections(id)" on-delete="CASCADE"/>
        <column name="simplefin_transaction_id" type="VARCHAR(255)" required="true"/>
        <column name="synced_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
      <constraints>
        <unique>connection_id, simplefin_transaction_id</unique>
      </constraints>
      <status>BACKEND ONLY - No frontend UI</status>
    </table>

    <!-- Business Expense Rules (Migration 018) -->
    <table name="business_expense_category_rules">
      <description>Keyword-based categorization rules for business transactions</description>
      <columns>
        <column name="id" type="SERIAL" primary-key="true"/>
        <column name="user_id" type="INTEGER" references="users(id)" on-delete="CASCADE" description="ADMIN only"/>
        <column name="keyword" type="VARCHAR(120)" required="true"/>
        <column name="category" type="VARCHAR(120)" required="true"/>
        <column name="match_field" type="VARCHAR(20)" default="description"/>
        <column name="transaction_type" type="VARCHAR(20)" default="expense"/>
        <column name="created_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
        <column name="updated_at" type="TIMESTAMP" default="CURRENT_TIMESTAMP"/>
      </columns>
      <status>ADMIN UI - Managed in BankAccountsPage</status>
    </table>

  </database-schema>

  <!-- ======================= FRONTEND STRUCTURE ======================= -->
  <frontend-structure base-path="frontend/src">

    <routing-file>App.js</routing-file>
    <router-library>react-router-dom v6</router-library>
    <current-routes>
      <route path="/" component="PortalLanding"/>
      <route path="/staff" component="Login"/>
      <route path="/login" component="Login (alias of /staff)"/>
      <route path="/parents" component="ParentLogin"/>
      <route path="/parent/login" component="ParentLogin"/>
      <route path="/parent/reset-password" component="ParentResetPassword"/>
      <route path="/dashboard" component="DashboardPage"/>
      <route path="/attendance" component="AttendancePage"/>
      <route path="/events" component="EventsPage"/>
      <route path="/families" component="FamiliesPage"/>
      <route path="/billing" component="BillingPage"/>
      <route path="/payments" component="PaymentsPage"/>
      <route path="/scheduling" component="StaffSchedulingPage"/>
      <route path="/educators" component="EducatorsPage"/>
      <route path="/pay" component="PayPeriodsPage"/>
      <route path="/time-entries" component="TimeEntriesApprovalPage"/>
      <route path="/finance" component="FinanceDashboardPage"/>
      <route path="/finance/transactions" component="FinanceTransactionsPage"/>
      <route path="/finance/accounts" component="FinanceAccountsPage"/>
      <route path="/finance/categories" component="FinanceCategoriesPage"/>
      <route path="/banking" redirect-to="/finance/accounts"/>
      <route path="/finance/reports" redirect-to="/reporting"/>
      <route path="/paperwork" component="PaperworkPage"/>
      <route path="/reporting" component="ReportingPage"/>
      <route path="/settings" component="SettingsPage"/>
      <route path="/educator/dashboard" component="EducatorDashboard"/>
      <route path="/educator/my-schedule" component="MySchedule"/>
      <route path="/educator/my-hours" component="MyHours"/>
      <route path="/educator/attendance" component="AttendancePage (EducatorLayout)"/>
      <route path="/educator/messages" component="EducatorMessages"/>
      <route path="/educator/my-paystubs" component="MyPaystubs"/>
      <route path="/parent/dashboard" component="ParentDashboard"/>
      <route path="/parent/invoices" component="ParentInvoices"/>
      <route path="/parent/messages" component="ParentMessages"/>
      <route path="/parent/events" component="ParentEvents"/>
      <route path="/parent/children" component="ParentChildren"/>
    </current-routes>
    <note>Role-gated routing enforced via RequireRole in App.js</note>
    <note>Parent sign-out in ParentLayout redirects to /parents (not /login).</note>

    <pages-directory path="pages/">
      <!-- Admin Dashboard & Core Pages -->
      <page file="DashboardPage.js">
        <description>Main admin dashboard with ops metrics, staffing compliance, and finance snapshot</description>
        <api-calls>
          <call endpoint="/children?status=ACTIVE"/>
          <call endpoint="/attendance?start_date={date}&end_date={date}"/>
          <call endpoint="/attendance/compliance?date={date}&ratio_kids={kids}&ratio_staff={staff}"/>
          <call endpoint="/schedules/admin/schedules?from={date}&to={date}"/>
          <call endpoint="/notifications/unread-count"/>
          <call endpoint="/invoices"/>
          <call endpoint="/events?from={date}&to={date}"/>
          <call endpoint="/business-expenses?start={date}&end={date}&limit={n}"/>
          <call endpoint="/time-off-requests?status=ALL"/>
          <call endpoint="/time-off-requests/:id/approve"/>
          <call endpoint="/time-off-requests/:id/reject"/>
        </api-calls>
        <components-used>Layout, MetricCard, BaseModal, AddChildModal, SendMessageModal, CreateEventModal</components-used>
        <responsive-features>
          <feature>Metric cards grid: grid-cols-1 md:grid-cols-2 lg:grid-cols-4</feature>
          <feature>Main content grid: grid-cols-1 lg:grid-cols-3</feature>
          <feature>Widget heights: h-[300px] sm:h-[350px] md:h-[400px]</feature>
          <feature>Responsive spacing: gap-6 md:gap-8</feature>
        </responsive-features>
        <notes>
          <note date="2026-02-03">/finance now serves as the admin Messages inbox; finance KPIs remain in the dashboard snapshot.</note>
          <note date="2026-02-03">Dashboard widgets updated: Present Today, Staff Scheduled, In Compliance (ratio popup), Pending Tasks. Attendance CTA added to header action bar.</note>
          <note date="2026-02-03">Finance snapshot panel replaces arrivals/absences; includes expense category pie chart, cash flow snapshot, and profit indicator.</note>
          <note date="2026-02-03">Time Off Requests panel replaces Staff Coverage; shows up to 2 items, includes a Time Requests header button, and opens an inline Time Off Details modal for approvals.</note>
          <note date="2026-02-03">Upcoming Events panel replaces Today's Events; shows next 2 upcoming events with a See More button when additional events exist.</note>
        </notes>
        <status>COMPLETE - Fully responsive</status>
      </page>

      <page file="AttendancePage.js">
        <description>Attendance tracking with check-in/out times</description>
        <api-calls>
          <call endpoint="GET /attendance?start_date={date}&end_date={date}"/>
          <call endpoint="GET /children?status=ACTIVE"/>
          <call endpoint="POST /attendance/check-in"/>
          <call endpoint="POST /attendance/check-out"/>
          <call endpoint="POST /attendance/mark-absent"/>
        </api-calls>
        <features>
          <feature>Date picker for historical attendance</feature>
          <feature>Check-in with parent name, notes, and optional manual time</feature>
          <feature>Check-out with parent name, notes, and optional manual time</feature>
          <feature>Mark absent/sick/vacation with notes</feature>
          <feature>Manual vs automatic time mode</feature>
        </features>
        <status>COMPLETE - Check-in/out and absence workflows enabled</status>
      </page>

      <page file="EventsPage.js">
        <description>Admin events calendar with month view and event details</description>
        <api-calls>
          <call endpoint="GET /events?from={date}&to={date}"/>
          <call endpoint="POST /events"/>
        </api-calls>
        <features>
          <feature>Month grid with daily event counts</feature>
          <feature>Agenda list for selected day</feature>
          <feature>Create event modal</feature>
          <feature>Event details modal</feature>
        </features>
        <status>ROUTED</status>
      </page>

      <page file="FamiliesPage.js">
        <description>Family management with directories for children and parents</description>
        <api-calls>
          <call endpoint="GET /families"/>
          <call endpoint="PATCH /families/:id/toggle-status"/>
          <call endpoint="GET /children"/>
          <call endpoint="GET /children/:id/emergency-contacts"/>
          <call endpoint="PATCH /children/:id"/>
          <call endpoint="GET /parents/directory"/>
          <call endpoint="PATCH /parents/:id"/>
          <call endpoint="POST /parents/:id/temp-password"/>
          <call endpoint="POST /children/:id/emergency-contacts"/>
          <call endpoint="DELETE /emergency-contacts/:id"/>
          <call endpoint="GET /files?linked_child_id={id}"/>
          <call endpoint="GET /files?linked_parent_id={id}"/>
          <call endpoint="/files/:id/download"/>
          <call endpoint="/files/:id" method="DELETE"/>
          <call endpoint="DELETE /families/:id"/>
        </api-calls>
        <modals-used>AddFamilyModal, BaseModal (for edit/delete)</modals-used>
        <features>
          <feature>Beautiful MagicPattern card-based UI with animations</feature>
          <feature>Add new family (FUNCTIONAL)</feature>
          <feature>Edit family - parents, children, allergies, medical notes (FUNCTIONAL)</feature>
          <feature>Delete family with option to remove parent accounts (FUNCTIONAL)</feature>
          <feature>Display family cards with parent/child info</feature>
          <feature>Monthly rate calculation and display</feature>
          <feature>Active/Inactive status badges</feature>
          <feature>Tabbed views for families, children directory, parent directory</feature>
          <feature>Children directory search, status filter, and sorting</feature>
          <feature>Waitlist priority updates from directory</feature>
          <feature>Parent directory search and account/billing filters</feature>
          <feature>View/download/delete files linked to children or parents</feature>
          <feature>Family login toggle (enable/disable parent accounts)</feature>
          <feature>Allergy management with toggle buttons</feature>
          <feature>Emergency contacts add/edit with primary contact selection</feature>
        </features>
        <ui-design>
          <layout>Card grid (md:grid-cols-2 lg:grid-cols-3)</layout>
          <styling>Rounded-3xl cards, soft shadows, pastel peach color scheme</styling>
          <animations>Framer Motion stagger animations</animations>
        </ui-design>
        <status>COMPLETE - Families, directories, and linked files wired</status>
      </page>

      <page file="EducatorsPage.js">
        <description>Staff management with FULL CRUD functionality</description>
        <api-calls>
          <call endpoint="GET /admin/users?role=EDUCATOR"/>
          <call endpoint="POST /admin/users"/>
          <call endpoint="PATCH /admin/users/:id"/>
          <call endpoint="DELETE /admin/users/:id"/>
          <call endpoint="PATCH /admin/users/:id/toggle-active"/>
        </api-calls>
        <modals-used>BaseModal (for add/edit/delete)</modals-used>
        <features>
          <feature>Beautiful MagicPattern centered card layout with animations</feature>
          <feature>Add new educator with comprehensive form (FUNCTIONAL)</feature>
          <feature>Edit educator - all fields including payment, time off, YTD (FUNCTIONAL)</feature>
          <feature>Delete educator with confirmation (FUNCTIONAL)</feature>
          <feature>Toggle active/inactive status (FUNCTIONAL)</feature>
          <feature>Display educator cards with large circular initials</feature>
          <feature>Staff initials avatars with rotating pastel colors</feature>
          <feature>Hourly rate, sick/vacation days display</feature>
          <feature>Payment type (hourly/salary) and frequency</feature>
          <feature>YTD tracking (gross, CPP, EI, tax, hours)</feature>
        </features>
        <ui-design>
          <layout>Card grid (md:grid-cols-2 lg:grid-cols-3) with centered content</layout>
          <styling>Rounded-3xl cards, large 24x24 avatars, rotating colors</styling>
          <animations>Framer Motion with lift-on-hover effect</animations>
          <colors>Purple, Green, Yellow, Coral rotating palette</colors>
        </ui-design>
        <status>COMPLETE - Full CRUD with beautiful UI</status>
      </page>

      <page file="BillingPage.js">
        <description>Invoice management and financial overview</description>
        <api-calls>
          <call endpoint="GET /invoices"/>
          <call endpoint="PATCH /invoices/:id"/>
          <call endpoint="DELETE /invoices/:id"/>
          <call endpoint="GET /invoices/:id/pdf"/>
          <call endpoint="GET /parents"/>
          <call endpoint="GET /parents/payments"/>
          <call endpoint="POST /parents/payments"/>
          <call endpoint="PATCH /parents/payments/:id"/>
          <call endpoint="POST /documents/parent-payments/:id/generate-receipt"/>
          <call endpoint="GET /documents/parent-payments/:id/receipt-pdf"/>
        </api-calls>
        <components-used>Layout, MetricCard</components-used>
        <features>
          <feature>Monthly revenue calculation</feature>
          <feature>Pending amount calculation</feature>
          <feature>Overdue amount calculation</feature>
          <feature>Invoice table with status badges</feature>
          <feature>Record payment modal with invoice linking</feature>
          <feature>Payment history with receipt download</feature>
          <feature>Mark invoice as paid via payment entry</feature>
          <feature>Mark pending payment as completed</feature>
          <feature>Edit invoice status, due date, notes, and payment terms</feature>
          <feature>Delete invoice with confirmation</feature>
          <feature>Download invoice PDF</feature>
          <feature>Show/hide closed invoices</feature>
        </features>
        <status>COMPLETE - Payments and invoice management enabled</status>
      </page>

      <page file="PaymentsPage.js">
        <description>Dedicated payments management</description>
        <api-calls>
          <call endpoint="GET /parents/payments"/>
          <call endpoint="POST /parents/payments"/>
          <call endpoint="PATCH /parents/payments/:id"/>
          <call endpoint="GET /parents"/>
          <call endpoint="GET /invoices"/>
          <call endpoint="PATCH /invoices/:id"/>
          <call endpoint="POST /documents/parent-payments/:id/generate-receipt"/>
          <call endpoint="GET /documents/parent-payments/:id/receipt-pdf"/>
        </api-calls>
        <modals-used>BaseModal</modals-used>
        <features>
          <feature>Record payment with optional invoice linking</feature>
          <feature>Payment history with status actions</feature>
          <feature>Mark pending payments as paid and generate receipts</feature>
          <feature>Download receipt PDFs</feature>
          <feature>Invoice table with mark-as-paid action</feature>
        </features>
        <status>COMPLETE - Payments management page functional</status>
      </page>

      <page file="PayPeriodsPage.js">
        <description>Payroll period management</description>
        <api-calls>
          <call endpoint="GET /pay-periods"/>
          <call endpoint="POST /pay-periods"/>
          <call endpoint="POST /pay-periods/generate"/>
          <call endpoint="GET /pay-periods/:id/close-preview"/>
          <call endpoint="POST /pay-periods/:id/close"/>
          <call endpoint="GET /documents/pay-periods/:id/export-excel"/>
        </api-calls>
        <displays>
          <item>Period date ranges</item>
          <item>Status (OPEN, CLOSED)</item>
          <item>Total amount, employee count, total hours</item>
          <item>Approved entries count</item>
        </displays>
        <features>
          <feature>Create pay period</feature>
          <feature>Auto-generate pay periods</feature>
          <feature>Close period with preview</feature>
          <feature>Export payroll to Excel</feature>
        </features>
        <status>COMPLETE - Create/generate/close/export enabled</status>
      </page>

      <page file="TimeEntriesApprovalPage.js">
        <description>Admin review of educator time-off requests with per-educator summaries</description>
        <api-calls>
          <call endpoint="GET /time-off-requests?status={status}"/>
          <call endpoint="GET /admin/users?role=EDUCATOR"/>
          <call endpoint="POST /time-off-requests/:id/approve"/>
          <call endpoint="POST /time-off-requests/:id/reject"/>
        </api-calls>
        <features>
          <feature>Educator summary cards with approved/pending totals</feature>
          <feature>Shows all educators, even with zero requests</feature>
          <feature>Detail modal per educator (approved/pending/rejected)</feature>
          <feature>Batch approve/reject grouped requests</feature>
          <feature>Range display for multi-day requests</feature>
        </features>
        <status>COMPLETE - Time-off request review</status>
      </page>

      <page file="StaffSchedulingPage.js">
        <description>Staff shift scheduling with monthly calendar view</description>
        <api-calls>
          <call endpoint="GET /schedules/admin/schedules?from={date}&to={date}&user_id={id}"/>
          <call endpoint="POST /schedules/admin/schedules"/>
          <call endpoint="PATCH /schedules/admin/schedules/:id"/>
          <call endpoint="DELETE /schedules/admin/schedules/:id"/>
          <call endpoint="POST /schedules/admin/schedules/recurring"/>
          <call endpoint="GET /admin/users?role=EDUCATOR"/>
        </api-calls>
        <modals-used>AddShiftModal</modals-used>
        <displays>
          <item>Monthly calendar grid with daily event counts</item>
          <item>Inline first-name + time labels (desktop)</item>
          <item>Approved time-off (vacation/sick/unpaid) shown in calendar</item>
          <item>Day detail modal with shift/time-off list</item>
        </displays>
        <features>
          <feature>Month navigation</feature>
          <feature>Educator filter</feature>
          <feature>Click any date to open detail modal</feature>
          <feature>Add shift button inside day detail modal (prefilled date)</feature>
          <feature>Create single shift</feature>
          <feature>Create recurring schedules</feature>
          <feature>Edit schedules</feature>
          <feature>Delete schedules</feature>
          <feature>Notes field</feature>
        </features>
        <status>COMPLETE - Monthly view + create/edit/delete/recurring enabled</status>
      </page>

      <page file="ReportingPage.js">
        <description>Analytics and reporting dashboard</description>
        <api-calls>
          <call endpoint="GET /reports/financial/revenue?start_date={date}&end_date={date}"/>
          <call endpoint="GET /reports/financial/outstanding"/>
          <call endpoint="GET /reports/financial/aging"/>
          <call endpoint="GET /reports/financial/payment-history?start_date={date}&end_date={date}"/>
          <call endpoint="GET /reports/enrollment/summary"/>
          <call endpoint="GET /reports/enrollment/trends"/>
          <call endpoint="GET /reports/enrollment/waitlist"/>
          <call endpoint="GET /reports/staffing/hours?start_date={date}&end_date={date}"/>
          <call endpoint="GET /reports/staffing/payroll"/>
          <call endpoint="GET /reports/staffing/coverage?start_date={date}&end_date={date}"/>
          <call endpoint="GET /attendance/report?start_date={date}&end_date={date}"/>
          <call endpoint="GET /attendance?start_date={date}&end_date={date}"/>
        </api-calls>
        <sections>
          <section name="Financial">Revenue, outstanding balances, aging</section>
          <section name="Enrollment">Summary, trends, waitlist</section>
          <section name="Staffing">Hours, payroll, coverage</section>
          <section name="Attendance">Summary or detailed log by date range</section>
        </sections>
        <status>COMPLETE - All report endpoints wired with date range controls</status>
      </page>

      <page file="BankAccountsPage.js">
        <description>Shared finance data loader + section renderer for Finance* pages</description>
        <api-calls>
          <call endpoint="/business-expenses/connections"/>
          <call endpoint="/business-expenses/connections/:id" method="PATCH"/>
          <call endpoint="/business-expenses/simplefin/claim"/>
          <call endpoint="/business-expenses/sync/:connectionId"/>
          <call endpoint="/business-expenses/connections/:id" method="DELETE"/>
          <call endpoint="/business-expenses"/>
          <call endpoint="/business-expenses/rules"/>
          <call endpoint="/business-expenses/rules/:id" method="PATCH"/>
          <call endpoint="/business-expenses/rules/:id" method="DELETE"/>
        </api-calls>
        <features>
          <feature>Connect account via SimpleFIN setup token</feature>
          <feature>Manual sync per connection</feature>
          <feature>Disconnect connections</feature>
          <feature>Last sync timestamp display</feature>
          <feature>Account settings for credit/debit, opening balance, and manual credit limit</feature>
          <feature>Account overview summary with dropdown filter (credit/debit grouped)</feature>
          <feature>Available balance + unposted estimate (credit requires limit)</feature>
          <feature>Income and expense totals with net cash flow</feature>
          <feature>Cash flow snapshot by month or term</feature>
          <feature>Reporting year controls and account filter dropdown</feature>
          <feature>Transaction table with search, filters, and uncategorized toggle</feature>
          <feature>Auto-categorization rules by keyword for income or expenses</feature>
        </features>
        <status>COMPLETE - Shared finance data + UI sections</status>
      </page>

      <page file="FinanceDashboardPage.js">
        <description>Admin messages inbox with list + detail view</description>
        <features>
          <feature>Left inbox list with read/unread filters and multi-select</feature>
          <feature>Bulk mark read/unread for selected or all messages</feature>
          <feature>Message detail panel with sender, timestamp, and body</feature>
        </features>
        <api-calls>
          <call endpoint="GET /messages/inbox?limit={n}"/>
          <call endpoint="PATCH /messages/:id/read"/>
          <call endpoint="PATCH /messages/bulk-update"/>
          <call endpoint="PATCH /messages/mark-all"/>
        </api-calls>
        <notes>
          <note date="2026-02-03">/finance repurposed from finance KPIs to an admin messages inbox.</note>
        </notes>
        <status>ROUTED - /finance (Messages)</status>
      </page>

      <page file="FinanceTransactionsPage.js">
        <description>Transaction list with filters and search</description>
        <features>
          <feature>Reporting year controls + account filter dropdown</feature>
          <feature>Search + type filters + uncategorized toggle</feature>
        </features>
        <status>ROUTED - /finance/transactions</status>
      </page>

      <page file="FinanceAccountsPage.js">
        <description>Connected bank feeds, sync controls, and account settings</description>
        <features>
          <feature>Connect/disconnect SimpleFIN accounts</feature>
          <feature>Manual sync and last sync status</feature>
          <feature>Account type + opening balance settings</feature>
        </features>
        <status>ROUTED - /finance/accounts</status>
      </page>

      <page file="FinanceCategoriesPage.js">
        <description>Category insights and auto-categorization rules</description>
        <features>
          <feature>Top category rollups</feature>
          <feature>Keyword-based rules management</feature>
        </features>
        <status>ROUTED - /finance/categories</status>
      </page>

      <page file="PaperworkPage.js">
        <description>Document management and uploads</description>
        <api-calls>
          <call endpoint="/files"/>
          <call endpoint="/files/upload"/>
          <call endpoint="/files/:id/download"/>
          <call endpoint="/files/:id" method="DELETE"/>
          <call endpoint="/files/categories"/>
          <call endpoint="/files/categories/:id" method="DELETE"/>
          <call endpoint="/children"/>
          <call endpoint="/parents"/>
        </api-calls>
        <modals-used>UploadDocumentModal</modals-used>
        <features>
          <feature>Category overview cards with active filtering</feature>
          <feature>Search and category filters wired to /files</feature>
          <feature>Category manager (create/delete)</feature>
          <feature>Upload with tags and linked child/parent</feature>
          <feature>Tags and description display</feature>
          <feature>Download and delete documents</feature>
        </features>
        <status>FUNCTIONAL - Document management wired to /files endpoints</status>
      </page>

      <page file="SettingsPage.js">
        <description>User settings and preferences</description>
        <api-calls>
          <call endpoint="GET /settings"/>
          <call endpoint="PATCH /settings"/>
          <call endpoint="/auth/change-password"/>
        </api-calls>
        <tabs>
          <tab name="Profile">Name, email, phone (not wired)</tab>
          <tab name="Security">Password change (FUNCTIONAL)</tab>
          <tab name="Notifications">Email/SMS preferences (not wired)</tab>
          <tab name="Preferences">Language, timezone, date format (not wired)</tab>
          <tab name="Billing">Tax rate and tax enabled settings (FUNCTIONAL)</tab>
          <tab name="Themes">Separate Staff/Admin and Parent portal theme selection (FUNCTIONAL)</tab>
          <tab name="Debug">Password-gated SimpleFIN diagnostics (internal use)</tab>
        </tabs>
        <features>
          <feature>Load all available themes on mount</feature>
          <feature>Display theme cards with primary color and card color swatches in two independent sections</feature>
          <feature>Show Active badge for each portal scope (staff/admin and parent)</feature>
          <feature>Show Selected badge for pending selection in each scope</feature>
          <feature>Apply staff/admin theme via PATCH /settings with theme_id</feature>
          <feature>Apply parent portal theme via PATCH /settings with parent_theme_id</feature>
          <feature>Staff/Admin theme applies immediately via ThemeContext</feature>
          <feature>Debug panel: view SimpleFIN status/connections and run sync with debug/force flags</feature>
          <feature>Debug panel: reset daily sync limit counter</feature>
        </features>
        <status>PARTIAL - Password change, billing, and themes functional</status>
      </page>

      <!-- Additional Admin Pages (legacy - kept as reference, not routed) -->
      <page file="AdminChildren.js">
        <description>Legacy children management page</description>
        <status>LEGACY - Not routed. Kept as reference only.</status>
      </page>

      <page file="AdminEducators.js">
        <description>Legacy educators management page with old UI</description>
        <note>Functionality has been migrated to EducatorsPage.js with MagicPattern UI</note>
        <status>LEGACY - Not routed. Kept as reference only.</status>
      </page>

      <page file="AdminFamilies.js">
        <description>Legacy families management page with old UI (3,422 lines)</description>
        <note>Functionality has been migrated to FamiliesPage.js with MagicPattern UI</note>
        <status>LEGACY - Not routed. Kept as reference only.</status>
      </page>

      <page file="AdminParents.js">
        <description>Parents-only management page</description>
        <status>EXISTS - Not routed in App.js</status>
      </page>

      <page file="AdminInvoices.js">
        <description>Invoice management page</description>
        <status>EXISTS - May duplicate BillingPage</status>
      </page>

      <page file="AdminPayments.js">
        <description>Payment tracking page</description>
        <status>EXISTS - Not routed in App.js</status>
      </page>

      <page file="AdminTimeEntries.js">
        <description>Time entry approval/management</description>
        <status>EXISTS - Not routed in App.js</status>
      </page>

      <page file="AdminSchedule.js">
        <description>Schedule management page</description>
        <status>EXISTS - May duplicate StaffSchedulingPage</status>
      </page>

      <page file="AdminPayPeriods.js">
        <description>Pay period management page</description>
        <status>EXISTS - May duplicate PayPeriodsPage</status>
      </page>

      <page file="AdminBilling.js">
        <description>Billing management page</description>
        <status>EXISTS - May duplicate BillingPage</status>
      </page>

      <page file="AdminFiles.js">
        <description>File management page</description>
        <status>EXISTS - May duplicate PaperworkPage</status>
      </page>

      <page file="AdminBusinessExpenses.js">
        <description>Business expenses page</description>
        <status>EXISTS - May duplicate BankAccountsPage</status>
      </page>

      <!-- Educator Portal Pages -->
      <page file="EducatorDashboard.js">
        <description>Educator dashboard</description>
        <status>ROUTED - Educator portal entry</status>
      </page>

      <page file="MySchedule.js">
        <description>Educator's personal schedule view with time-off request batching</description>
        <features>
          <feature>Monthly calendar with shift/time-off indicators</feature>
          <feature>Selectable dates for time-off requests</feature>
          <feature>Full-day selections submit as contiguous date ranges</feature>
          <feature>Half-day selections submit as single-day requests</feature>
        </features>
        <status>ROUTED</status>
      </page>

      <page file="MyHours.js">
        <description>Schedule-based hours summary and shift history</description>
        <status>ROUTED</status>
      </page>

      <page file="EducatorMessages.js">
        <description>Educator inbox for parent messages</description>
        <api-calls>
          <call endpoint="GET /messages/inbox"/>
          <call endpoint="PATCH /messages/:id/read"/>
          <call endpoint="GET /messages/recipients"/>
          <call endpoint="POST /messages/send"/>
        </api-calls>
        <status>ROUTED</status>
      </page>

      <page file="AttendancePage.js">
        <description>Attendance page reused for educators (requires scheduled shift today)</description>
        <status>ROUTED - /educator/attendance</status>
      </page>

      <page file="MyPaystubs.js">
        <description>Educator paystubs view</description>
        <status>ROUTED</status>
      </page>

      <!-- Parent Portal Pages -->
      <page file="ParentDashboard.js">
        <description>Parent portal dashboard</description>
        <status>ROUTED - Parent portal entry</status>
      </page>

      <page file="ParentChildren.js">
        <description>Parent's children view</description>
        <status>ROUTED</status>
      </page>

      <page file="ParentInvoices.js">
        <description>Parent invoice view</description>
        <status>ROUTED</status>
      </page>

      <page file="ParentMessages.js">
        <description>Parent messaging interface</description>
        <status>ROUTED</status>
      </page>

      <page file="ParentEvents.js">
        <description>Parent read-only events calendar (month view)</description>
        <status>ROUTED</status>
      </page>

      <!-- Authentication Pages -->
      <page file="Login.js">
        <description>Staff login page</description>
        <status>ROUTED</status>
      </page>

      <page file="ParentLogin.js">
        <description>Parent portal login page</description>
        <features>
          <feature>Uses the same tokenized parent portal visual language (shell, card, icon chip, script wordmark, input/button styles) as ParentDashboard/ParentLayout.</feature>
          <feature>Includes a "Stay logged in" checkbox that persists parent email/password to localStorage key parent-portal-saved-login for next-login prefill on the same browser.</feature>
        </features>
        <status>ROUTED</status>
      </page>

      <page file="ParentResetPassword.js">
        <description>Parent password reset (token or forced reset flow)</description>
        <status>ROUTED</status>
      </page>

      <!-- Utility Pages -->

      <page file="Settings.js">
        <description>Alternative settings page</description>
        <status>EXISTS - May duplicate SettingsPage</status>
      </page>
    </pages-directory>

    <components-directory path="components/">
      <component file="Layout.js">
        <description>Main layout wrapper with header, sidebar, and search</description>
        <props>
          <prop name="children" type="ReactNode"/>
          <prop name="title" type="string"/>
          <prop name="subtitle" type="string" optional="true"/>
        </props>
        <features>
          <feature>Formatted current date display</feature>
          <feature>Search bar (visual only, hidden on mobile, shown md+)</feature>
          <feature>Notifications bell with unread count + popover feed</feature>
          <feature>User avatar (visual only)</feature>
          <feature>Hamburger menu button for mobile sidebar toggle</feature>
          <feature>Responsive header layout (column on mobile, row on desktop)</feature>
          <feature>Responsive padding: p-4 sm:p-6 md:p-8 lg:p-10</feature>
          <feature>Dynamic main padding: no left padding on mobile, lg:pl-64 on desktop</feature>
        </features>
        <responsive-behavior>
          <mobile>Hamburger menu visible, search hidden, header stacked vertically</mobile>
          <tablet>Search appears, header horizontal</tablet>
          <desktop>Full sidebar visible, no hamburger menu</desktop>
        </responsive-behavior>
      </component>

      <component file="Sidebar.js">
        <description>Collapsible Operations/Finance sidebar with pinned dashboards</description>
        <props>
          <prop name="isOpen" type="boolean" description="Controls sidebar visibility on mobile"/>
          <prop name="onClose" type="function" description="Callback to close mobile sidebar"/>
        </props>
        <features>
          <feature>Operations + Finance sections with chevron toggles</feature>
          <feature>Dashboards remain visible even when sections are collapsed</feature>
          <feature>Grouped sub-links for Payroll &amp; Time and Billing &amp; Payments</feature>
          <feature>Active route highlighting with animated indicator</feature>
          <feature>Mobile drawer with overlay backdrop + close button</feature>
        </features>
        <responsive-behavior>
          <mobile>Hidden by default, slides in from left when opened, overlay backdrop</mobile>
          <desktop>Always visible, fixed position, no overlay</desktop>
        </responsive-behavior>
        <menu-items>
          <item path="/dashboard" icon="LayoutDashboard">Daycare Dashboard</item>
          <item section="Operations" path="/attendance" icon="ClipboardCheck">Attendance</item>
          <item section="Operations" path="/events" icon="Calendar">Events</item>
          <item section="Operations" path="/families" icon="Users">Families</item>
          <item section="Operations" path="/educators" icon="GraduationCap">Staff</item>
          <item section="Operations" path="/scheduling" icon="Calendar">Scheduling</item>
          <item section="Operations" path="/paperwork" icon="FileText">Paperwork</item>
          <item section="Operations" path="/pay" icon="DollarSign">Pay Periods</item>
          <item section="Operations" path="/time-entries" icon="Clock">Time Entries</item>
          <item section="Operations" path="/settings" icon="Settings">Settings</item>
          <item path="/finance" icon="Mail">Messages</item>
          <item section="Finance" path="/finance/transactions" icon="Wallet">Transactions</item>
          <item section="Finance" path="/finance/accounts" icon="Landmark">Bank Accounts</item>
          <item section="Finance" path="/finance/categories" icon="Tag">Categories</item>
          <item section="Finance" path="/reporting" icon="BarChart3">Reports</item>
          <item section="Finance" path="/billing" icon="CreditCard">Billing</item>
          <item section="Finance" path="/payments" icon="DollarSign">Payments</item>
        </menu-items>
      </component>

      <component file="DashboardWidgets.js">
        <description>Reusable dashboard components</description>
        <exports>
          <widget name="MetricCard">Animated stat card with icon and value</widget>
        </exports>
      </component>
    </components-directory>

    <modals-directory path="components/modals/">
      <modal file="BaseModal.js">
        <description>Reusable modal wrapper component with capped height and scrollable body</description>
        <props>
          <prop name="isOpen" type="boolean" description="Controls modal visibility"/>
          <prop name="onClose" type="function" description="Callback to close modal"/>
          <prop name="title" type="string" description="Modal header title"/>
          <prop name="children" type="ReactNode" description="Modal body content"/>
          <prop name="maxWidth" type="string" optional="true" default="max-w-2xl" description="Tailwind max-width class"/>
        </props>
        <features>
          <feature>Backdrop with blur effect</feature>
          <feature>Framer Motion animations (scale, fade, slide)</feature>
          <feature>Close button in header</feature>
          <feature>Scrollable content area with max-h-[90vh]</feature>
          <feature>Responsive padding: p-4 sm:p-6</feature>
          <feature>Responsive border radius: rounded-2xl sm:rounded-3xl</feature>
          <feature>Responsive title size: text-xl sm:text-2xl</feature>
        </features>
        <responsive-behavior>
          <mobile>Smaller padding, smaller border radius, full width with margin</mobile>
          <desktop>Larger padding, larger border radius, constrained by maxWidth</desktop>
        </responsive-behavior>
        <status>Base component for all modals</status>
      </modal>

      <modal file="AddFamilyModal.js">
        <description>Add new family with parents and children</description>
        <api-endpoint>POST /families</api-endpoint>
        <features>
          <feature>Dynamic parent addition (1-2 parents)</feature>
          <feature>Single child per submission</feature>
          <feature>Emergency contacts entry with primary contact selection</feature>
          <feature>Address input</feature>
          <feature>Primary contact auto-designation</feature>
        </features>
        <status>FUNCTIONAL - Used in FamiliesPage</status>
      </modal>

      <modal file="AddEducatorModal.js">
        <description>Add new educator/admin user</description>
        <api-endpoint>POST /admin/users</api-endpoint>
        <features>
          <feature>Personal info (name, email, phone)</feature>
          <feature>Role selection (EDUCATOR/ADMIN)</feature>
          <feature>Hourly rate input</feature>
          <feature>Certification and experience fields</feature>
        </features>
        <status>FUNCTIONAL - Used in EducatorsPage</status>
      </modal>

      <modal file="AddChildModal.js">
        <description>Add new child enrollment</description>
        <status>EXISTS - Implementation status unknown</status>
      </modal>

      <modal file="AddShiftModal.js">
        <description>Create staff shift/schedule</description>
        <status>EXISTS - Implementation status unknown</status>
      </modal>

      <modal file="CreateInvoiceModal.js">
        <description>Create parent invoice</description>
        <status>EXISTS - Implementation status unknown</status>
      </modal>

      <modal file="SendMessageModal.js">
        <description>Send message to parent/staff</description>
        <status>EXISTS - Implementation status unknown</status>
      </modal>

      <modal file="CreateEventModal.js">
        <description>Create calendar event</description>
        <status>FUNCTIONAL - Used in DashboardPage and EventsPage</status>
      </modal>

      <modal file="EventDetailsModal.js">
        <description>Read-only event details modal</description>
        <status>FUNCTIONAL - Used in EventsPage and ParentEvents</status>
      </modal>

      <modal file="ConfirmModal.js">
        <description>Reusable confirm dialog (sign-out)</description>
        <status>FUNCTIONAL - Used in Layouts/Sidebar</status>
      </modal>

      <modal file="UploadDocumentModal.js">
        <description>Upload document/file</description>
        <status>EXISTS - Implementation status unknown</status>
      </modal>
    </modals-directory>

    <utilities-directory path="utils/">
      <utility file="api.js">
        <description>Axios instance with JWT interceptor</description>
        <configuration>
          <base-url>process.env.REACT_APP_API_URL</base-url>
          <headers>
            <header name="Content-Type">application/json</header>
          </headers>
        </configuration>
        <interceptors>
          <request>Attaches JWT token from localStorage</request>
          <response>Redirects to /login on 401 errors</response>
        </interceptors>
      </utility>

      <utility file="timeFormat.js">
        <description>Time formatting utilities</description>
        <status>EXISTS</status>
      </utility>
    </utilities-directory>

    <contexts-directory path="contexts/">
      <context file="AuthContext.js">
        <description>Authentication context provider</description>
        <status>INTEGRATED - Used by App.js and index.js</status>
      </context>
      <context file="ThemeContext.js">
        <description>Loads active theme and applies CSS variables + font imports</description>
        <exports>
          <export name="ThemeProvider">Context provider component wrapping app</export>
          <export name="useTheme">Hook returning { theme, loading, setTheme }</export>
        </exports>
        <functions>
          <function name="applyTheme">Sets CSS variables on document.documentElement</function>
          <function name="hexToRgb">Converts hex colors to RGB for rgba() usage</function>
          <function name="ensureFontImport">Manages Google Fonts link tag in head</function>
        </functions>
        <css-variables-set>
          <variable>--primary</variable>
          <variable>--primary-dark</variable>
          <variable>--primary-rgb</variable>
          <variable>--accent</variable>
          <variable>--background</variable>
          <variable>--surface</variable>
          <variable>--text</variable>
          <variable>--muted</variable>
          <variable>--border</variable>
          <variable>--on-primary</variable>
          <variable>--on-accent</variable>
          <variable>--card-1</variable>
          <variable>--card-2</variable>
          <variable>--card-3</variable>
          <variable>--card-4</variable>
          <variable>--card-text-1</variable>
          <variable>--card-text-2</variable>
          <variable>--card-text-3</variable>
          <variable>--card-text-4</variable>
          <variable>--font-heading</variable>
          <variable>--font-body</variable>
        </css-variables-set>
        <status>INTEGRATED - Used by index.js</status>
      </context>
    </contexts-directory>

    <styling>
      <framework>Tailwind CSS</framework>
      <config-file>tailwind.config.js</config-file>
      <postcss-config>postcss.config.js</postcss-config>
      <custom-fonts>
        <font name="Quicksand">For headings</font>
        <font name="Inter">For body text</font>
      </custom-fonts>
      <public-site-migration>
        <description>Public marketing pages mirror Weebly output while app portals remain React/Tailwind.</description>
        <public-layout-file>frontend/src/pages/public/PublicLayout.js</public-layout-file>
        <public-pages-path>frontend/src/pages/public/</public-pages-path>
        <persistent-cta>
          <item>Global fixed portal quick links are rendered by PublicLayout on all public pages and breakpoints.</item>
          <target-url>Staff: {portalBase}/staff, Parent: {portalBase}/parents where portalBase comes from REACT_APP_PORTAL_BASE_URL or is derived from current hostname (localhost uses same origin + mode=portal).</target-url>
          <placement>Top-right inset on desktop; at viewport widths <= 1024px, CTA is placed below the fixed header. Staff/Parent pills use equal fixed widths.</placement>
        </persistent-cta>
        <public-style-files>
          <file>frontend/public/files/main_style.css</file>
          <file>frontend/public/public-overrides.css</file>
          <file>frontend/public/fonts.css</file>
        </public-style-files>
        <font-sources>
          <source>Raleway loaded from //cdn2.editmysite.com/fonts/Raleway/font.css?2</source>
          <source>Lora loaded from //cdn2.editmysite.com/fonts/Lora/font.css?2</source>
          <source>Gentium Basic loaded from //cdn2.editmysite.com/fonts/Gentium_Basic/font.css?2</source>
          <source>Playfair Display loaded from //cdn2.editmysite.com/fonts/Playfair_Display/font.css?2</source>
          <source>Saginaw loaded from //cdn2.editmysite.com/fonts/Saginaw/font.css?2</source>
          <source>Montserrat loaded from //cdn2.editmysite.com/fonts/Montserrat/font.css?2</source>
        </font-sources>
        <navigation-parity>
          <desktop-container>#navigation = 960px wide, 34px tall, 40px bottom padding, centered, uppercase, 13px container text context</desktop-container>
          <desktop-menu>#navigation ul.wsite-menu-default = 714px wide, 34px tall</desktop-menu>
          <desktop-link-typography>.wsite-menu-default a = Montserrat, 11px, weight 400, letter-spacing 1px (>=767px)</desktop-link-typography>
        </navigation-parity>
        <page-parity-adjustments>
          <item>Services and About pages use Weebly CDN Dawn-Sky background URL for section parity.</item>
          <item>Policies page uses Weebly PDF icon URL (//www.weebly.com/weebly/images/file_icons/pdf.png).</item>
          <item>Contact page map iframe uses Weebly generateMap endpoint URL for visual parity.</item>
          <item>Contact form submit control uses Weebly-style anchor button markup with hidden submit input.</item>
          <item>Public navigation list items use Weebly page ID format (pg{pageId}) for non-active links.</item>
          <item>Home gallery anchors include Weebly lightbox rel and image container ID pattern.</item>
          <item>Public overrides neutralize Tailwind image max-width/display side effects for galleryImage sizing/cropping parity.</item>
          <item>Public page section backgrounds (Home/Vision/Services/Policies) now use scroll attachment so backgrounds move with content.</item>
        </page-parity-adjustments>
      </public-site-migration>
      <color-palette>
        <primary>#FF9B85</primary>
        <primary-dark>#E07A5F</primary-dark>
        <accent>#FFE5D9</accent>
        <background>#FFF8F3</background>
        <purple>#E5D4ED</purple>
        <green>#B8E6D5</green>
        <yellow>#FFF4CC</yellow>
        <peach>#FFDCC8</peach>
      </color-palette>
      <theme-system>
        <description>Active theme applies CSS variables for palette + fonts via ThemeContext</description>
        <variables>--primary, --primary-dark, --accent, --background, --surface, --text, --muted, --border, --on-primary, --on-accent, --card-1, --card-2, --card-3, --card-4, --card-text-1, --card-text-2, --card-text-3, --card-text-4</variables>
        <active-theme-endpoint>/api/themes/active</active-theme-endpoint>
        <available-themes>
          <theme name="Default" primary="#FF9B85" mood="Current system theme"/>
          <theme name="Ocean Breeze" primary="#87CEEB" mood="Calm, trustworthy, fresh"/>
          <theme name="Forest Garden" primary="#B2C9AB" mood="Organic, nurturing"/>
          <theme name="Sunset Warmth" primary="#FF9B85" mood="Welcoming, energetic"/>
          <theme name="Berry Bright" primary="#9B6B9E" mood="Creative, confident"/>
          <theme name="Little Sparrows Public" primary="#5199A8" mood="Public-site inspired"/>
        </available-themes>
        <theme-flow>
          <step>ThemeContext checks localStorage for cached theme on mount</step>
          <step>If authenticated, fetches /themes/active endpoint</step>
          <step>Applies CSS variables to document root via applyTheme()</step>
          <step>Parent login and parent in-app routes share the same parent token set for 1:1 visual consistency.</step>
          <step>Parent portal shell uses theme-derived shell/header/nav/card/input/button tokens (with optional background image + overlay)</step>
          <step>Dynamically loads Google Fonts via ensureFontImport()</step>
          <step>Admin can change Staff/Admin theme and Parent theme separately in Settings page Themes tab</step>
          <step>Staff/Admin theme persists to daycare_settings.theme_id</step>
          <step>Parent theme persists to daycare_settings.parent_theme_id</step>
          <step>/themes/active resolves by role: PARENT uses parent_theme_id (fallback theme_id), ADMIN/EDUCATOR use theme_id</step>
        </theme-flow>
      </theme-system>
      <responsive-design>
        <breakpoints>
          <sm>640px - Small devices</sm>
          <md>768px - Medium devices</md>
          <lg>1024px - Large devices (sidebar appears)</lg>
          <xl>1280px - Extra large devices</xl>
        </breakpoints>
        <patterns>
          <pattern name="Sidebar Collapse">
            Sidebar hidden on mobile (<lg), accessible via hamburger menu.
            Uses translate-x animation with overlay backdrop on mobile.
          </pattern>
          <pattern name="Responsive Padding">
            Main content: p-4 sm:p-6 md:p-8 lg:p-10
            Modals: p-4 sm:p-6
            Adjusts based on available screen space
          </pattern>
          <pattern name="Header Layout">
            Flexbox switches from column (mobile) to row (desktop).
            Search bar hidden on mobile (<md), shows on medium+ screens.
            Title font size: text-2xl sm:text-3xl
          </pattern>
          <pattern name="Widget Heights">
            Dashboard widgets: h-[300px] sm:h-[350px] md:h-[400px]
            Scales down on smaller screens to prevent excessive scrolling
          </pattern>
          <pattern name="Grid Responsiveness">
            Metric cards: grid-cols-1 md:grid-cols-2 lg:grid-cols-4
            Content sections: grid-cols-1 lg:grid-cols-3
            Ensures single column on mobile, expands on larger screens
          </pattern>
        </patterns>
      </responsive-design>
    </styling>

    <animation>
      <library>Framer Motion</library>
      <usage>
        <usage-item>Page enter animations</usage-item>
        <usage-item>Staggered list animations</usage-item>
        <usage-item>Active sidebar tab indicator (layoutId="activeTab")</usage-item>
        <usage-item>Hover scale effects</usage-item>
      </usage>
    </animation>

  </frontend-structure>

  <!-- ======================= BACKEND ARCHITECTURE ======================= -->
  <backend-architecture>
    <entry-point>backend/src/server.js</entry-point>
    <port>5000 (default, configurable via PORT env var)</port>
    <framework>Express.js</framework>
    <cors>Allowlist in production via ALLOWED_ORIGINS or FRONTEND_URL; permissive in development</cors>

    <middleware>
      <middleware-file>backend/src/middleware/auth.js</middleware-file>
      <function name="requireAuth">
        <description>Verifies JWT token and attaches req.user (and req.parent for PARENT users)</description>
        <behavior>
          <step>Extract token from Authorization header</step>
          <step>Verify token with JWT_SECRET</step>
          <step>Load user from users table and attach to req.user</step>
          <step>If role is PARENT, load parent profile by user_id and attach to req.parent</step>
          <step>Return 401 if token invalid or missing</step>
        </behavior>
      </function>

      <function name="requireAdmin">
        <description>Checks if user has ADMIN role</description>
        <behavior>
          <step>Requires requireAuth to run first</step>
          <step>Check if req.user.role === 'ADMIN'</step>
          <step>Return 403 if not admin</step>
        </behavior>
      </function>

      <function name="requireStaff">
        <description>Checks if user has ADMIN or EDUCATOR role</description>
        <behavior>
          <step>Requires requireAuth to run first</step>
          <step>Check if req.user.role is in ('ADMIN', 'EDUCATOR')</step>
          <step>Return 403 if not staff</step>
        </behavior>
      </function>

      <function name="requireParent">
        <description>Checks if user has PARENT role and active parent profile</description>
        <behavior>
          <step>Requires requireAuth to run first</step>
          <step>Check if req.user.role === 'PARENT' and req.parent exists</step>
          <step>Return 403 if parent account is inactive</step>
        </behavior>
      </function>
    </middleware>

    <auth>
      <registration>Bootstrap-only: /auth/register creates the first ADMIN, then disables registration</registration>
      <rate-limiting>Auth endpoints (/auth/register, /auth/login, /auth/parent-reset-password) are rate-limited</rate-limiting>
      <parent-auth>Parents authenticate via unified /auth/login and receive tokens with parentId</parent-auth>
      <forced-reset>Parents can be flagged with users.must_reset_password and must complete /auth/force-reset-password</forced-reset>
    </auth>

    <routes-directory>backend/src/routes/</routes-directory>
    <route-files>
      <route-file>auth.js</route-file>
      <route-file>timeEntries.js</route-file>
      <route-file>admin.js</route-file>
      <route-file>payPeriods.js</route-file>
      <route-file>families.js</route-file>
      <route-file>parents.js</route-file>
      <route-file>children.js</route-file>
      <route-file>documents.js</route-file>
      <route-file>files.js</route-file>
      <route-file>schedules.js</route-file>
      <route-file>emergencyContacts.js</route-file>
      <route-file>invoices.js</route-file>
      <route-file>reports.js</route-file>
      <route-file>attendance.js</route-file>
      <route-file>billing.js</route-file>
      <route-file>businessExpenses.js</route-file>
      <route-file>settings.js</route-file>
      <route-file>themes.js</route-file>
      <route-file>messages.js</route-file>
      <route-file>events.js</route-file>
      <route-file>notifications.js</route-file>
      <route-file>timeOffRequests.js</route-file>
      <route-file>parentEvents.js</route-file>
      <route-file>parentDashboard.js</route-file>
      <route-file>parentInvoices.js</route-file>
      <route-file>parentDocuments.js</route-file>
      <route-file>parentMessages.js</route-file>
    </route-files>

    <services-directory>backend/src/services/</services-directory>
    <service-files>
      <service-file>pdfGenerator.js</service-file>
      <service-file>excelGenerator.js</service-file>
      <service-file>simplefinService.js</service-file>
      <service-file>fireflyService.js</service-file>
      <service-file>syncService.js</service-file>
      <service-file>scheduler.js</service-file>
      <service-file>themesService.js</service-file>
      <service-file>emailService.js</service-file>
    </service-files>

    <utilities-directory>backend/src/utils/</utilities-directory>
    <utility-files>
      <utility-file>jwt.js</utility-file>
      <utility-file>encryption.js</utility-file>
      <utility-file>notifications.js</utility-file>
      <utility-file>appNotifications.js</utility-file>
      <utility-file>owner.js</utility-file>
    </utility-files>

    <scheduler>
      <description>Automated task scheduler for production</description>
      <file>backend/src/services/scheduler.js</file>
      <initialization>Only runs in production (NODE_ENV === 'production')</initialization>
      <tasks>
        <task>Recurring invoice generation from billing templates</task>
        <task>Automatic SimpleFIN transaction sync</task>
        <task>Notification queue processing every 5 minutes</task>
      </tasks>
    </scheduler>
  </backend-architecture>

  <!-- ======================= EXTERNAL INTEGRATIONS ======================= -->
  <external-integrations>

    <integration name="SimpleFIN Bridge">
      <description>Business credit card transaction sync</description>
      <service-file>backend/src/services/simplefinService.js</service-file>
      <purpose>Connect business credit cards to sync transactions to Firefly III</purpose>
      <flow>
        <step>Admin obtains Setup Token from SimpleFIN Bridge</step>
        <step>Backend calls /api/business-expenses/simplefin/claim with Setup Token</step>
        <step>Backend exchanges Setup Token for Access URL (stored encrypted)</step>
        <step>Backend creates Firefly III expense account</step>
        <step>Manual or automated sync fetches transactions via SimpleFIN API</step>
        <step>Transactions posted to Firefly III via API</step>
        <step>Deduplication via transaction_sync_log table</step>
      </flow>
      <environment-variables>
        <var name="ENCRYPTION_KEY" required="true">For encrypting SimpleFIN Access URLs</var>
      </environment-variables>
      <status>BACKEND COMPLETE - Frontend in BankAccountsPage</status>
    </integration>

      <integration name="Firefly III">
        <description>Personal finance manager for business expenses</description>
        <service-file>backend/src/services/fireflyService.js</service-file>
        <purpose>Store and categorize business expenses from SimpleFIN</purpose>
        <operations>
          <operation>Create expense accounts</operation>
          <operation>Post transactions</operation>
          <operation>Link to SimpleFIN accounts</operation>
        </operations>
        <environment-variables>
          <var name="FIREFLY_BASE_URL" required="true">Firefly III instance URL</var>
          <var name="FIREFLY_SERVICE_PAT" required="true">Personal Access Token</var>
        </environment-variables>
        <note>Firefly UI can be routed behind the main domain (e.g., /firefly) or, preferably, a dedicated subdomain (e.g., firefly.littlesparrowsacademy.com). Link from Settings via REACT_APP_FIREFLY_URL (or the /firefly-redirect route).</note>
        <note>Traefik Prefix routing on /firefly also matches /firefly-redirect. Ensure /firefly-redirect routes to the frontend (higher priority or explicit rule), or change the Firefly path to /firefly/.</note>
        <status>BACKEND COMPLETE</status>
      </integration>

    <integration name="PDF Generation">
      <description>Generate PDFs for paystubs, invoices, receipts</description>
      <service-file>backend/src/services/pdfGenerator.js</service-file>
      <library>PDFKit</library>
      <generated-documents>
        <document type="Paystub">Educator pay stubs with YTD totals</document>
        <document type="Invoice">Parent invoices with line items and tax</document>
        <document type="Receipt">Payment receipts</document>
      </generated-documents>
      <status>BACKEND COMPLETE - Frontend buttons open PDFs (Billing/Payments/MyPaystubs)</status>
      <delivery>
        <method>Signed URL for direct browser open</method>
        <admin-receipts>POST /documents/parent-payments/:id/receipt-link -> /documents/receipt-open?token=...</admin-receipts>
        <admin-invoices>POST /invoices/:id/pdf-link -> /invoices/pdf-open?token=...</admin-invoices>
        <parent-invoices>POST /parent/invoices/:id/pdf-link -> /invoices/pdf-open?token=...</parent-invoices>
        <note>Signed tokens are short-lived and allow correct filename in PDF viewer</note>
      </delivery>
    </integration>

    <integration name="Excel Export">
      <description>Export payroll data to Excel spreadsheets</description>
      <service-file>backend/src/services/excelGenerator.js</service-file>
      <library>ExcelJS</library>
      <exports>
        <export>Payroll summaries by pay period</export>
      </exports>
      <status>BACKEND COMPLETE - Export button in PayPeriodsPage</status>
    </integration>

    <integration name="Email Notifications">
      <description>Send email notifications to parents and staff</description>
      <status>IMPLEMENTED - SMTP via Nodemailer</status>
      <service-file>backend/src/services/emailService.js</service-file>
      <processor>backend/src/utils/notifications.js (processPendingNotifications)</processor>
      <table-ready>YES - notifications table used for EMAIL queue; in-app uses app_notifications</table-ready>
      <environment-variables>
        <var name="SMTP_HOST" required="true">SMTP host</var>
        <var name="SMTP_PORT" required="true">SMTP port</var>
        <var name="SMTP_USER" required="true">SMTP username</var>
        <var name="SMTP_PASS" required="true">SMTP password</var>
        <var name="SMTP_FROM" required="true">Default from address</var>
        <var name="SMTP_SECURE" required="false">true for SMTPS, false for STARTTLS</var>
      </environment-variables>
      <notes>EMAIL notifications are sent; SMS delivery remains future work</notes>
    </integration>

  </external-integrations>

  <!-- ======================= DEPLOYMENT & ENVIRONMENT ======================= -->
  <deployment>

    <environment-variables>
      <required>
        <var name="DATABASE_URL">PostgreSQL connection string</var>
        <var name="JWT_SECRET">Secret key for JWT token signing</var>
        <var name="ENCRYPTION_KEY">Key for encrypting SimpleFIN Access URLs</var>
      </required>
      <optional>
        <var name="PORT">Backend server port (default: 5000)</var>
        <var name="NODE_ENV">Environment (development/production)</var>
        <var name="ALLOWED_ORIGINS">Comma-separated CORS allowlist for production</var>
        <var name="FRONTEND_URL">Single frontend origin (fallback for CORS allowlist)</var>
        <var name="FIREFLY_BASE_URL">Firefly III instance URL (for business expenses)</var>
        <var name="FIREFLY_SERVICE_PAT">Firefly III Personal Access Token</var>
        <var name="REACT_APP_API_URL">Frontend API base URL (default: /api)</var>
        <var name="REACT_APP_FIREFLY_URL">Frontend link to Firefly III UI (default: /firefly)</var>
        <var name="REACT_APP_PORTAL_BASE_URL">Portal base URL used by public-site CTA and cross-site redirects</var>
        <var name="REACT_APP_PUBLIC_BASE_URL">Public site base URL used by portal-to-public redirects</var>
        <var name="SMTP_HOST">SMTP host</var>
        <var name="SMTP_PORT">SMTP port</var>
        <var name="SMTP_USER">SMTP username</var>
        <var name="SMTP_PASS">SMTP password</var>
        <var name="SMTP_FROM">Default from address</var>
        <var name="SMTP_SECURE">true for SMTPS, false for STARTTLS</var>
        <var name="SYNC_TIMEZONE">Timezone for scheduler (default: UTC)</var>
        <var name="SYNC_LOOKBACK_DAYS">Number of days to look back on each sync (default: 7)</var>
      </optional>
    </environment-variables>

    <frontend-env-files>
      <development-file>frontend/.env.development</development-file>
      <production-template>frontend/.env.production.example</production-template>
      <production-note>Production values should come from deployment environment/secrets, not committed .env files.</production-note>
    </frontend-env-files>

    <file-storage>
      <location>backend/uploads/</location>
      <naming-convention>{fieldname}-{timestamp}-{random}.{ext}</naming-convention>
      <max-file-size>20MB</max-file-size>
      <allowed-types>PDF, JPG, PNG, DOCX, DOC</allowed-types>
    </file-storage>

      <database-setup>
        <migration-command>node backend/src/db/migrate.js</migration-command>
        <migrations-directory>backend/migrations/</migrations-directory>
        <naming-pattern>000_*.sql through 037_*.sql (sequential)</naming-pattern>
        <total-migrations>38</total-migrations>
      </database-setup>

      <backend-server>
        <framework>Express.js</framework>
        <port>5000 (default)</port>
        <entry-point>backend/src/server.js</entry-point>
        <cors>Allowlist in production via ALLOWED_ORIGINS or FRONTEND_URL</cors>
        <health-check>GET /health</health-check>
        <time-endpoint>GET /api/time</time-endpoint>
      </backend-server>

    <frontend-server>
      <framework>Create React App</framework>
      <port>3000 (default)</port>
      <build-command>npm run build</build-command>
      <build-output>frontend/build/</build-output>
    </frontend-server>

  </deployment>

  <!-- ======================= CURRENT STATE ASSESSMENT ======================= -->
  <current-state-assessment>

    <strengths>
      <strength>Complete database schema with 20+ tables and 28 migrations</strength>
      <strength>Comprehensive backend API with 100+ endpoints</strength>
      <strength>Clean MagicPattern UI design with Tailwind CSS</strength>
      <strength>Robust authentication with unified user table and parent profiles</strength>
      <strength>Advanced features: SimpleFIN/Firefly business expense tracking</strength>
      <strength>PDF generation for paystubs, invoices, receipts</strength>
      <strength>Functional modals for adding families and educators</strength>
      <strength>8 modals exist for CRUD operations</strength>
      <strength>Automated scheduler for recurring tasks (production)</strength>
    </strengths>

    <weaknesses>
      <weakness>Multiple duplicate pages (Admin* vs regular pages) - unclear which is canonical</weakness>
      <weakness>Legacy Admin* pages exist but are not routed and may drift from canonical pages</weakness>
      <weakness>Many modals exist but unclear which are wired to pages</weakness>
      <weakness>Billing templates feature has no frontend</weakness>
      <weakness>Many reports available in backend but not shown in UI</weakness>
      <weakness>SMS notifications not implemented</weakness>
      <weakness>No automated tests</weakness>
      <weakness>No API documentation</weakness>
      <weakness>Legacy/deprecated code not cleaned up (document_categories)</weakness>
    </weaknesses>

    <immediate-priorities>
      <priority rank="1">Consolidate duplicate pages (Admin* vs regular) - decide canonical version</priority>
      <priority rank="2">Wire up existing modals to pages (AddChild, CreateInvoice, UploadDocument, etc.)</priority>
      <priority rank="3">Clarify which Admin* pages remain as reference vs remove/redirect</priority>
      <priority rank="4">Harden notification workflows (email/SMS) and delivery status tracking</priority>
      <priority rank="5">Add edit/delete functionality to existing pages</priority>
      <priority rank="6">Add notification templates and SMS/in-app delivery paths</priority>
    </immediate-priorities>

    <technical-debt>
      <issue category="Code Organization">
        <title>Duplicate Pages and Components</title>
        <description>Many Admin* pages duplicate functionality of regular pages (AdminDashboard vs DashboardPage, AdminFamilies vs FamiliesPage, etc.)</description>
        <impact>Confusion, maintenance burden, potential for drift</impact>
        <recommendation>Audit all pages, consolidate duplicates, establish single canonical version</recommendation>
      </issue>

      <issue category="Routing">
        <title>Legacy Admin Pages Not Routed</title>
        <description>Admin* pages exist but are not routed; canonical pages are routed via App.js with RequireRole gating.</description>
        <impact>Potential confusion and drift between legacy and canonical implementations</impact>
        <recommendation>Decide canonical pages, remove or redirect legacy Admin* pages</recommendation>
      </issue>

      <issue category="Database Schema">
        <title>Document Categories Deprecated But Table Remains</title>
        <description>document_categories table still exists but categories are now hardcoded</description>
        <impact>Unused table, confusion</impact>
        <recommendation>Drop document_categories table after confirming no references</recommendation>
      </issue>

      <issue category="Frontend Completeness">
        <title>Modals Built But Not All Wired</title>
        <description>8 modals exist but unclear which are integrated with pages</description>
        <impact>Features partially built, inconsistent UX</impact>
        <recommendation>Audit each modal, ensure proper integration with corresponding pages</recommendation>
      </issue>

      <issue category="Features">
        <title>Notification Delivery Gaps</title>
        <description>Email notifications are implemented; SMS delivery and template standardization remain limited</description>
        <impact>Communication is email-only and lacks multi-channel coverage</impact>
        <recommendation>Add SMS provider and standardize templates with tracking</recommendation>
      </issue>

      <issue category="Testing">
        <title>No Automated Tests</title>
        <description>No unit tests, integration tests, or E2E tests</description>
        <impact>High risk of regressions, manual testing burden</impact>
        <recommendation>Add Jest for backend, React Testing Library for frontend</recommendation>
      </issue>

      <issue category="Documentation">
        <title>No API Documentation</title>
        <description>100+ endpoints with no Swagger/OpenAPI docs</description>
        <impact>Difficult for developers to understand API</impact>
        <recommendation>Generate Swagger docs or add OpenAPI spec</recommendation>
      </issue>
    </technical-debt>

  </current-state-assessment>

  <!-- ======================= SUMMARY FOR NEXT ENGINEER ======================= -->
  <summary>

    <overview>
      This is a comprehensive full-stack daycare management system built with Node.js/Express backend and React frontend. The database schema is extensive (20+ tables, 25 migrations), and the backend API is robust (100+ endpoints). The frontend has a MagicPattern design with RequireRole-gated routes for admin, educator, and parent portals, plus in-app notifications, time-off requests, and events calendars. The system manages children enrollment, attendance tracking, parent billing, educator scheduling, payroll, messaging, events, and business expense tracking via SimpleFIN/Firefly III.
    </overview>

    <key-architectural-decisions>
      <decision>Unified authentication via users table; parents are linked via parents.user_id and tokens include parentId</decision>
      <decision>Many-to-many parent-child relationships via parent_children junction table</decision>
      <decision>Migration-based schema evolution (25 migrations applied)</decision>
      <decision>Scheduled tasks only run in production mode</decision>
      <decision>Document categories hardcoded in code, not database-driven</decision>
      <decision>Modular route structure with separate parent portal routes</decision>
    </key-architectural-decisions>

    <onboarding-steps>
      <step>Review this SYSTEM_DOCUMENTATION.xml thoroughly</step>
      <step>Set up PostgreSQL database</step>
      <step>Run migrations: node backend/src/db/migrate.js</step>
      <step>Configure environment variables (.env file)</step>
      <step>Install dependencies: npm install in both backend/ and frontend/</step>
      <step>Start backend server: npm start in backend/ (port 5000)</step>
      <step>Start frontend server: npm start in frontend/ (port 3000)</step>
      <step>Audit duplicate pages: Compare Admin* pages with regular pages</step>
      <step>Review App.js to understand current routing</step>
      <step>Check which modals are wired to which pages</step>
      <step>Choose a high-priority task from immediate-priorities list</step>
    </onboarding-steps>

  </summary>

</daycare-management-system>

